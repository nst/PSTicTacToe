%!PS
%
% Play Tic-Tac-Toe against your printer
% 2024-04 Nicolas Seriot https://github.com/nst/PSTicTacToe
% 
% On GhostScript:
% gs ttt.ps
% 
% On a real PostScript printer:
% cat ttt.ps - | nc 192.168.2.10 9100

/g{getinterval}def/D(123456789)def/SB{()= b 0 3 g = b 3 3 g = b 6 3 g =()= m
null ne{m =}if}def/nf{0 b{46 eq{1 add}if}forall}def/pp_b_{/pp false def 0 1 8{/i
exch def/b2 b dup length string cvs def b2 i 1 g(.)eq{[(X)(O)]{/p exch def b2 i
p putinterval b2 bob{b i(X)putinterval/pp true def exit}if}forall}if pp{exit}if}
for pp}def/ppr{/x rand nf mod def/c 0 def 0 1 b length 1 sub{/i exch def b i 1 g
(.)eq{c x eq{b i(X)putinterval exit}if/c c 1 add def}if}for}def/r_i_{{(human \
turn (1-9) >)print flush(%lineedit)(r)file(        )readline pop dup length 0 gt
{0 1 g}{pop ( )}ifelse/o exch def D o search{pop pop pop b o cvi 1 sub 1 g(.)eq{
o cvi 1 sub exit}if}{pop}ifelse(bad input)= SB PB}loop}def/bob{/bd exch def
/lines[[0 1 2][3 4 5][6 7 8][0 3 6][1 4 7][2 5 8][0 4 8][2 4 6]]def/ov false def
[(O)(X)]{/p exch def lines{/poss exch def/ov true def poss{/pos exch def/ov bd
pos 1 g p eq ov and def}forall ov{exit}if}forall ov{exit}if}forall ov}def/PB{0.2
setlinewidth 10 10 scale 20 70 moveto 20 40 lineto 30 70 moveto 30 40 lineto 10
60 moveto 40 60 lineto 10 50 moveto 40 50 lineto stroke 0 1 b length 1 sub{/i
exch def b i 1 g(.)ne{gsave 10 i 3 mod 10 mul add 3 add 70 i 3 idiv 10 mul sub 7
sub moveto b i 1 g show grestore}if}for m null ne{10 30 moveto m show}if
showpage}def/_s_b_Check{/dp exch def/s7 exch def/m null def nf 0 eq{/m(TIE)def
/dp true def}if b bob{/m(        WINS)def m 0 s7 putinterval/dp true def}if dp{
SB PB}if m null ne{quit}if}def/Courier findfont 5 scalefont setfont/b D def/m
(HUMAN PLAYS O)def SB PB/b(.........)def{/m null def b r_i_(O)putinterval
(  HUMAN)false _s_b_Check pp_b_ not{ppr}if(PRINTER)true _s_b_Check}loop
